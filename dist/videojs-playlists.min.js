/*!
 * videojs-playlists - Playlists done right for Videojs
 * v0.2.0
 * 
 * copyright Antonio Laguna, Ori Ziv 2016
 * MIT License
*/
(function(){function a(a,b){var c=this;c.pl=c.pl||{};var d=parseInt(a,10);return c.pl._guessVideoType=function(a){var b={webm:"video/webm",mp4:"video/mp4",ogv:"video/ogg","ism/manifest":"application/vnd.ms-sstr+xml"};if(!a)return b.mp4;var c=a.split(".").pop();return b[c]||""},c.pl.init=function(a,b){b=b||{},c.pl.videos=[],c.pl.current=0,c.on("ended",c.pl._videoEnd),b.getVideoSource&&(c.pl.getVideoSource=b.getVideoSource),c.pl._addVideos(a)},c.pl._updatePoster=function(a){c.poster(a),c.removeChild(c.posterImage),c.posterImage=c.addChild("posterImage")},c.pl._addVideos=function(a){for(var b=0,d=a.length;d>b;b++){for(var e=[],f=0,g=a[b].src.length;g>f;f++){var h={type:c.pl._guessVideoType(a[b].src[f]),src:a[b].src[f]};a[b].token&&(h.protectionInfo=[{type:video[b].tokenType||"AES",authenticationToken:a[b].token}]),e.push(h)}a[b].src=e,c.pl.videos.push(a[b])}},c.pl._nextPrev=function(a){var b,d;if("next"===a?(b=c.pl.videos.length-1,d=1):(b=0,d=-1),c.pl.current!==b){var e=c.pl.current+d;c.pl._setVideo(e),c.trigger(a,[c.pl.videos[e]])}},c.pl._stopPlaylist=function(){c.pl.current=0,c.pl.currentVideo=c.pl.videos[0],c.pause(),c.currentTime(0)},c.pl._setVideo=function(a){var b=c.currentSrc(),d=0;if(a<c.pl.videos.length){if(c.pl.current=a,c.pl.currentVideo=c.pl.videos[a],c.paused()||c.pl._resumeVideo(),b&&-1!==b.indexOf(c.pl.currentVideo.src[0].src)){try{c.pl.currentVideo.timeRange&&(d=c.pl.currentVideo.timeRange.start),setTimeout(function(){c.currentTime(d)})}catch(e){}return void(c.paused()&&setTimeout(function(){c.play()},0))}c.pl.getVideoSource?c.pl.getVideoSource(c.pl.videos[a],function(a,b){c.pl._setVideoSource(a,b)}):c.pl._setVideoSource(c.pl.videos[a].src,c.pl.videos[a].poster)}},c.pl._setVideoSource=function(a,b){console.log("set source"),c.src(a),c.pl._updatePoster(b)},c.pl._resumeVideo=function(){c.one("loadstart",function(){setTimeout(function(){c.play()},0)})},c.pl._videoEnd=function(){c.pl.current===c.pl.videos.length-1?c.trigger("lastVideoEnded"):(c.pl._resumeVideo(),c.next())},a instanceof Array?(c.pl.init(a,b),c.pl._setVideo(0),c):d===d?(c.pl._setVideo(d),c):"string"==typeof a&&"undefined"!=typeof c.pl[a]?(c.pl[a].apply(c),c):void 0}amp.plugin("playlist",a),amp.Player.prototype.next=function(){return this.pl._nextPrev("next"),this},amp.Player.prototype.prev=function(){return this.pl._nextPrev("prev"),this},amp.Player.prototype.stop=function(){return this.pl._stopPlaylist(),this}}).call(this);